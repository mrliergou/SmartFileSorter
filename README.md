# 文件批量移动器

一个智能化、现代化的文件批量移动/复制工具，使用 CustomTkinter 构建美观的用户界面，支持智能规则匹配和批量处理。

## 功能特性

### 核心功能
- **批量文件处理**：支持批量移动或复制文件
- **智能规则匹配**：根据文件名关键词自动分类文件
- **规则管理器**：可视化管理分类规则，支持添加/删除/编辑/排序
- **规则建议**：自动分析文件名词频，智能推荐分类规则
- **关键词过滤**：支持多关键词过滤，灵活筛选目标文件
- **递归扫描**：可选择是否扫描子文件夹
- **复制模式**：可选择复制而非移动，保留原文件
- **智能重命名**：自动处理重名文件（如：文件名(1).ext）
- **自动查重合并**：自动检测并合并指向相同目标的规则

### 界面特点
- 现代化扁平设计风格
- 直观的颜色编码（绿色=添加、红色=删除、橙色=编辑、蓝色=操作、紫色=管理、青色=查重）
- 实时日志输出，操作过程一目了然
- 自定义应用图标
- **主界面规则展示**：规则以复选框形式显示，支持快速操作
- **双向同步**：主界面和规则管理器的规则自动同步

### 智能特性
- **批量确认**：一次性展示所有文件分类，统一确认后执行
- **智能分组**：自动将文件分为无匹配、单一匹配、多规则匹配三类
- **多规则处理**：当文件匹配多条规则时，可交互选择或自动使用第一条
- **复选框批量选择**：规则建议功能支持批量选择关键词
- **规则批量操作**：支持多选规则进行批量删除
- **规则独立编辑**：pattern和target分别显示和编辑，更加直观

## 安装

### 环境要求
- Python 3.8+
- Windows / macOS / Linux

### 安装依赖

```bash
pip install -r requirements.txt
```

或手动安装：

```bash
pip install customtkinter>=5.2.0
pip install Pillow>=10.0.0
```

## 使用方法

### 运行程序

```bash
python 文件批量移动器_现代版.py
```

### 基本操作流程

1. **选择源文件夹**：点击"浏览"按钮选择要处理的文件所在文件夹
2. **选择目标文件夹**：点击"浏览"按钮选择文件移动的目标位置
3. **设置文件类型**：输入要处理的文件扩展名，用逗号分隔（如：`pdf,doc,docx`）
4. **添加关键词**（可选）：输入关键词过滤文件，支持批量输入（用空格、逗号等分隔）
5. **扫描文件**：点击"扫描文件"按钮查看匹配的文件列表
6. **执行操作**：点击"执行移动/复制"按钮开始处理文件

### 主界面规则操作

主界面直接显示所有规则，支持快速操作：
- **查看规则**：规则以 `关键词 → 目标文件夹` 格式显示
- **选择规则**：勾选一个或多个规则复选框
- **删除选中**：批量删除选中的规则
- **编辑选中**：编辑单条规则（只能选一条）
  - 关键词和目标文件夹分别编辑
  - 支持使用 `|` 分隔多个关键词（如：`试卷|卷子`）

### 规则管理器（高级功能）

点击"规则管理器"按钮打开高级管理界面：
- **添加规则**：设置关键词模式和目标子文件夹
  - 支持使用 `|` 分隔多个关键词（如：`试卷|卷子`）
  - 文件名匹配任一关键词即可应用该规则
- **删除选中**：批量删除多条选中的规则
- **编辑选中**：编辑单条规则，pattern和target分别修改
- **上移/下移**：调整规则优先级（只能选一条）
- **自动查重**：自动检测并合并相同目标的规则
  - 例如：`数量 → 数资` 和 `资料 → 数资` 会合并为 `数量 | 资料 → 数资`
- **建议规则**：分析文件夹中的文件名，智能推荐常用关键词

### 选项设置

- **递归检测**：勾选后会扫描子文件夹中的文件
- **复制模式**：勾选后会复制文件而不是移动（保留原文件）
- **智能模式**：多规则匹配时自动使用第一条规则，无需逐个确认

## 配置文件

程序会自动创建 `config.json` 配置文件，保存以下设置：
- 关键词列表
- 文件类型设置
- 规则列表
- 递归检测选项
- 复制模式选项

配置文件位置：
- 打包后的exe：与exe文件同目录
- Python脚本：与脚本文件同目录

## 打包为可执行文件

### 安装打包工具

```bash
pip install pyinstaller>=6.0.0
```

### 使用 spec 文件打包（推荐）

```bash
pyinstaller build.spec
```

### 使用命令行打包

```bash
pyinstaller --name="文件批量移动器" \
    --onefile \
    --windowed \
    --icon=icon.ico \
    --add-data "icon.ico;." \
    --hidden-import="PIL._tkinter_finder" \
    文件批量移动器_现代版.py
```

打包完成后，可执行文件位于 `dist` 目录下。

## 注意事项

1. **文件安全**：建议先使用"复制模式"测试，确认无误后再使用移动模式
2. **重名处理**：如果目标文件夹已存在同名文件，会自动重命名为 `文件名(1).扩展名`
3. **权限问题**：确保对源文件夹和目标文件夹有读写权限
4. **首次运行**：首次运行时可能需要等待几秒钟加载

## 技术栈

- **Python 3.x**
- **CustomTkinter** - 现代化UI框架
- **Pillow** - 图像处理
- **PyInstaller** - 打包工具

## 项目结构

```
文件批量移动器/
├── 文件批量移动器_现代版.py    # 主程序源代码
├── create_icon.py              # 图标生成脚本
├── icon.ico                    # 应用图标
├── icon.png                    # 图标PNG版本
├── build.spec                  # PyInstaller配置文件
├── requirements.txt            # 依赖包列表
├── 打包说明.md                 # 详细打包说明
├── README.md                   # 本文件
└── config.json                 # 配置文件（运行后自动生成）
```

## 许可证

本项目仅供学习和个人使用。

## 贡献

欢迎提交 Issue 和 Pull Request！

## 更新日志

### v2.1 (2025-12-04)
- **主界面规则展示**：规则以复选框形式直接显示在主界面
- **规则批量操作**：支持多选规则进行批量删除
- **规则独立编辑**：pattern和target分别显示和编辑，更加直观
- **自动查重合并**：新增自动查重按钮，可自动合并相同目标的规则
- **双向同步**：主界面和规则管理器的规则自动同步更新
- **界面优化**：使用滚动框架，支持显示大量规则
- **颜色编码扩展**：新增橙色（编辑）和青色（查重）按钮

### v2.0 (2025-12-03)
- 使用 CustomTkinter 重构UI，界面更加现代化
- 新增规则管理器功能
- 新增规则建议功能（智能分析文件名）
- 新增批量确认功能
- 优化多规则匹配处理
- 改进日志输出，增加图标标识
- 支持复制模式
